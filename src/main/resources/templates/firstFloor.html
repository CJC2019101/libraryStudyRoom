<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>主页</title>

    <link rel="stylesheet" type="text/css" th:href="@{/style/css/base.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/style/css/login.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/style/layui/css/layui.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/style/layer/skin/layer.css}">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://cdn.bootcss.com/bootstrap-table/1.16.0/bootstrap-table.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap-table/1.16.0/bootstrap-table.min.css" rel="stylesheet">


    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--    <script type="text/javascript" th:src="@{/style/js/jquery-1.7.1.min.js}"></script>-->
    <script src="https://cdn.bootcss.com/bootstrap-table/1.16.0/bootstrap-table.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-table/1.16.0/bootstrap-table.min.js"></script>
    <script type="text/javascript" th:src="@{/style/js/jquery.cookie.js}"></script>
    <script type="text/javascript" th:src="@{/style/layui/layui.js}"></script>
    <script type="text/javascript" th:src="@{/style/layer/layer.js}"></script>
    <style>
        .text-center {
            font-weight: 700;
        / / 字体加粗
            /*color: #2b2b2b;*/
        font-size: 40 px;
        }

        .table {
            font-size: 20px;
        }

        #loginALabel {
            position: absolute;
            top: 20px;
            right: 10px;
        }

        #modalDiv {
            width: 800px;
        }

        .tableButton {

        }
    </style>

</head>
<body>

<div id="loginALabel">
    <a>Cookie中获取用户信息</a>
</div>


<!-- 教室座位模态框 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" id="modalDiv">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title text-center" id="myModalLabel">
                    <!--                    模态框（Modal）标题-->
                </h4>
            </div>
            <div class="modal-body" id="roomDiv">
                <table class="table table-striped" id="roomTable">
                    <!--在此处填充表格数据-->
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
                <button type="button" class="btn btn-primary">
                    提交
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<h3 class="text-center">城科图书馆</h3>
<table id="rooms" class="table table-hover" style="margin-top: 10px">
    <thead>
    <tr>
        <th>教室号</th>
        <th>楼层</th>
        <th>规格</th>
        <th>操作</th>
    </tr>
    </thead>
</table>


<script type="text/javascript">

    //一加载就执行填充信息  用于记住登录信息
    $(document).ready(function () {

        //发送ajax请求
        $.ajax({
            type: 'GET',
            url: '/findAllRooms',
            // data: 'floorNumber=' + 1,
            dataType: 'JSON',
            error: function (data) {
                alert("连接超时");
            },
            success: function (data) {
                if (data.code === 200) {
                    var rooms = data.data
                    for (var i = 0; i < rooms.length; i++) {
                        $("#rooms").append("<tr><td>" + rooms[i].id +
                            "</td><td>" + rooms[i].floorNumber +
                            "楼</td><td>" + rooms[i].roomLong + "x" + rooms[i].roomWidth +
                            "</td><td class='tableButton'><button  class=\"btn btn-primary \" data-toggle=\"modal\" data-target=\"#myModal\">" +
                            "座位</button>"
                            // <!-- 按钮触发模态框 -->
                            +
                            "</td></tr>")
                    }
                } else {
                    alert(data.msg())
                    window.location.href = "/main.html"
                }
            }
        });


    })


    // 座位按钮点击事件
    $("#rooms").delegate(".tableButton ", "click", function () {
        var row = $(this).parent().index() + 1; // 行位置
        var col = $(this).index() + 1; // 列位置

        var x = document.getElementById('rooms').rows[row].cells;
        var roomId = x[0].innerHTML // 教室号
        alert("当前位置：第" + row + "行，第" + col + "列，教室号：" + roomId)
        //发送ajax请求
        $.ajax({
            type: 'GET',
            url: '/findRoom',
            data: 'roomId=' + roomId,
            dataType: 'JSON',
            error: function (data) {
                alert("连接超时");
            },
            success: function (data) {
                if (data.code === 200) {
                    var $table = $('#roomTable');//绑定表格id
                    var room = data.data
                    buildTable($table, room.roomWidth, room.roomLong); //设置所要加载的表格列数和行数，此处为24行24列
                } else {
                    alert(data.msg())
                    window.location.href = "/firstFloor.html"
                }
            }
        });

    });


    // 创建表格
    function buildTable($el, cells, rows) {
        var i, j, row,
            columns = [],
            data = [];
        var roomTitle = $('#myModalLabel');
        // roomTitle.html("daf")

        for (i = 1; i <= cells; i++) {
            columns.push({
                field: 'field' + i,
                title: '第' + i + '列',
                sortable: true
            });
        }
        for (i = 1; i <= rows; i++) {
            row = {};
            for (j = 1; j <= cells; j++) {
                row['field' + j] = i + '行' + j + '列';
            }
            data.push(row);
        }
        $el.bootstrapTable('destroy').bootstrapTable({
            columns: columns,
            data: data,
            search: true,
            toolbar: '.toolbar'
        });
    }


</script>


</body>
</html>